<div class="custom-swiper-gallery">
  <div class="swiper-container">
    <div class="swiper-wrapper">
      {% for block in section.blocks %}
        <div class="swiper-slide" data-color="{{ block.settings.color_tag | downcase }}" style="display: none;">
          <img
            src="{{ block.settings.image | image_url: width: 1200 }}"
            alt="{{ block.settings.alt_text }}"
            width="1200"
            height="auto"
            style="width: 100%; height: auto;"
          >
        </div>
      {% endfor %}
    </div>

    {% if section.settings.show_pagination %}
      <div class="swiper-pagination"></div>
    {% endif %}

    {% if section.settings.show_navigation %}
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const swiper = new Swiper('.swiper-container', {
      slidesPerView: {{ section.settings.slides_desktop }},
      spaceBetween: {{ section.settings.space_between }},
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });

    const colorSelect = document.querySelector('select[name^="options"]');
    if (colorSelect) {
      console.log('Color selector found');
      colorSelect.addEventListener('change', function () {
        const selectedColor = this.value.toLowerCase();
        console.log('Selected color:', selectedColor);
        let matchedSlides = 0;

        document.querySelectorAll('.swiper-slide').forEach(function (slide) {
          const color = slide.getAttribute('data-color');
          if (color === selectedColor) {
            slide.style.display = 'block';
            matchedSlides++;
          } else {
            slide.style.display = 'none';
          }
        });

        console.log('Matching slides found:', matchedSlides);
        swiper.update();
      });
    } else {
      console.warn('Color selector NOT found');
    }
  });
</script>

{% schema %}
{
  "name": "Custom Swiper Gallery",
  "settings": [
    {
      "type": "range",
      "id": "slides_desktop",
      "label": "Slides on Desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "slides_tablet",
      "label": "Slides on Tablet",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "slides_mobile",
      "label": "Slides on Mobile",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 1
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "Show Pagination",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show Navigation Arrows",
      "default": true
    },
    {
      "type": "range",
      "id": "space_between",
      "label": "Space Between Slides",
      "min": 0,
      "max": 50,
      "step": 5,
      "default": 10
    }
  ],
  "blocks": [
    {
      "type": "image_slide",
      "name": "Image Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Alt Text"
        },
        {
          "type": "text",
          "id": "color_tag",
          "label": "Color Tag"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Swiper Gallery",
      "category": "Media"
    }
  ]
}
{% endschema %}